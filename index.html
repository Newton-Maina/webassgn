<!DOCTYPE html>
<html>
<head>
    <title>Visitor Tracking</title>
    <script type="text/javascript">
    // Retrieve a cookie value by its name
    function getCookie(c_name) {
        if (document.cookie.length > 0) {
            let c_start = document.cookie.indexOf(c_name + "=");
            if (c_start != -1) {
                c_start = c_start + c_name.length + 1;
                let c_end = document.cookie.indexOf(";", c_start);
                if (c_end == -1) c_end = document.cookie.length;
                return decodeURIComponent(document.cookie.substring(c_start, c_end));
            }
        }
        return "";
    }

    // Set a cookie with a name, value, and expiration date
    function setCookie(c_name, value, expiredays) {
        try {
            const exdate = new Date();
            exdate.setDate(exdate.getDate() + expiredays);
            const cookieValue = c_name + "=" + encodeURIComponent(value) +
                ";expires=" + exdate.toUTCString() +
                ";path=/";
            document.cookie = cookieValue;
            console.log("Cookie set:", cookieValue);
            return true;
        } catch (error) {
            console.error("Error setting cookie:", error);
            return false;
        }
    }

    // Check if the cookies exist, update the DOM accordingly, and prompt for first-time visitors
    function checkCookie() {
        console.log("Current cookies:", document.cookie);
        const username = getCookie('username');
        const lastVisit = getCookie('lastVisit');

        // Get current date in a readable format
        const currentDate = new Date().toLocaleString();

        if (username) {
            // User has visited before
            let welcomeMessage = 'Welcome back, ' + username + '!';

            if (lastVisit) {
                welcomeMessage += '\nYour last visit was: ' + lastVisit;
            }

            alert(welcomeMessage);

            // Update the last visit date if user has visited before
            setCookie('lastVisit', currentDate, 365);
        } else {
            // First-time visitor
            const newUsername = prompt('Please enter your name:', "");

            if (newUsername != null && newUsername != "") {
                if (setCookie('username', newUsername, 365)) {
                    console.log("Username cookie set successfully");
                }
                if (setCookie('lastVisit', currentDate, 365)) {
                    console.log("Initial visit date set successfully");
                }
                alert('Welcome, ' + newUsername + '! This is your first visit.');
            }
        }

        // Update the display after cookies are checked and set
        updateDisplay();
    }

    // Update the page display with the cookie values
    function updateDisplay() {
        document.getElementById('usernameDisplay').textContent = getCookie('username') || 'Not set';
        document.getElementById('lastVisitDisplay').textContent = getCookie('lastVisit') || 'Not set';
    }

    // Clear cookies and update the display
    function clearCookies() {
        document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        document.cookie = "lastVisit=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        updateDisplay(); // Update the display after clearing cookies
        alert('Cookies have been cleared!');
    }
    </script>
</head>
<body onload="checkCookie()">
    <h1>Welcome to Our Website</h1>
    <p>This page demonstrates cookie-based visitor tracking.</p>
    <div id="cookieInfo" style="margin-top: 20px; padding: 10px; background-color: #f0f0f0;">
        <h3>Cookie Information:</h3>
        <p>Username: <span id="usernameDisplay"></span></p>
        <p>Last Visit: <span id="lastVisitDisplay"></span></p>
        <button onclick="clearCookies()">Clear Cookies</button>
    </div>
</body>
</html>
