<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visitor Tracking</title>
    <script type="text/javascript">
        // Function to get the value of a cookie by its name
        function fetchCookie(cookieName) {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.indexOf(cookieName + "=") === 0) {
                    return decodeURIComponent(cookie.substring(cookieName.length + 1));
                }
            }
            return "";
        }

        // Function to set a cookie with a name, value, and expiration days
        function storeCookie(cookieName, value, daysUntilExpire) {
            try {
                const expirationDate = new Date();
                expirationDate.setDate(expirationDate.getDate() + daysUntilExpire);
                const cookieString = `${cookieName}=${encodeURIComponent(value)}; expires=${expirationDate.toUTCString()}; path=/`;
                document.cookie = cookieString;
                console.log(`Cookie set: ${cookieString}`);
                return true;
            } catch (error) {
                console.error("Failed to set cookie:", error);
                return false;
            }
        }

        // Function to handle visitor's cookie-related interactions
        function handleVisitor() {
            const userName = fetchCookie('visitorName');
            const lastVisit = fetchCookie('lastVisited');
            const currentTime = new Date().toLocaleString();

            // Check if the visitor has been here before
            if (userName) {
                let welcomeMessage = `Welcome back, ${userName}!`;
                if (lastVisit) {
                    welcomeMessage += ` Your last visit was: ${lastVisit}`;
                }

                alert(welcomeMessage);
                storeCookie('lastVisited', currentTime, 365); // Update last visit date
            } else {
                // First-time visitor
                const newUser = prompt('Please enter your name:');

                if (newUser) {
                    storeCookie('visitorName', newUser, 365); // Set visitor name
                    storeCookie('lastVisited', currentTime, 365); // Set the visit time for the first time
                    alert(`Welcome, ${newUser}! This is your first visit.`);
                }
            }

            // Update the display with the latest cookie values
            updateCookieInfoDisplay();
        }

        // Function to update the page display with current cookie information
        function updateCookieInfoDisplay() {
            const userName = fetchCookie('visitorName') || 'Not Set';
            const lastVisit = fetchCookie('lastVisited') || 'Not Set';
            document.getElementById('usernameDisplay').textContent = userName;
            document.getElementById('lastVisitDisplay').textContent = lastVisit;
        }

        // Function to clear the cookies and update the display
        function eraseCookies() {
            storeCookie('visitorName', '', -1);  // Set cookies to expire
            storeCookie('lastVisited', '', -1);
            updateCookieInfoDisplay(); // Update the display after clearing cookies
            alert('All cookies have been cleared!');
        }
    </script>
</head>
<body onload="handleVisitor()">
    <h1>Welcome to Our Website</h1>
    <p>This page demonstrates cookie-based visitor tracking.</p>

    <div id="cookieInfo" style="margin-top: 20px; padding: 10px; background-color: #f0f0f0;">
        <h3>Cookie Information:</h3>
        <p>Username: <span id="usernameDisplay">Loading...</span></p>
        <p>Last Visit: <span id="lastVisitDisplay">Loading...</span></p>
        <button onclick="eraseCookies()">Clear Cookies</button>
    </div>

</body>
</html>

