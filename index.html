<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visitor Tracking Portal</title>
    <script type="text/javascript">
    // Function to retrieve a specific cookie value
    function retrieveVisitorCookie(cookieKey) {
        if (document.cookie.length > 0) {
            let startIdx = document.cookie.indexOf(cookieKey + "=");
            if (startIdx != -1) {
                startIdx = startIdx + cookieKey.length + 1;
                let endIdx = document.cookie.indexOf(";", startIdx);
                if (endIdx == -1) endIdx = document.cookie.length;
                return decodeURIComponent(document.cookie.substring(startIdx, endIdx));
            }
        }
        return "";
    }

    // Function to set a cookie with a specific expiration date
    function storeVisitorCookie(cookieKey, cookieValue, daysToExpire) {
        try {
            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + daysToExpire);
            const cookieString = cookieKey + "=" + encodeURIComponent(cookieValue) +
                ";expires=" + expiryDate.toUTCString() +
                ";path=/";
            document.cookie = cookieString;
            console.log("Cookie successfully set:", cookieString);
            return true;
        } catch (error) {
            console.error("Error setting cookie:", error);
            return false;
        }
    }

    // Function to display personalized message based on cookies
    function manageVisitorCookies() {
        console.log("Cookies in current session:", document.cookie);
        const visitorName = retrieveVisitorCookie('visitorName');
        const lastVisitDate = retrieveVisitorCookie('lastVisitDate');

        const currentDate = new Date().toLocaleString();

        if (visitorName) {
            // Returning visitor
            let welcomeMessage = 'Welcome back, ' + visitorName + '!';

            if (lastVisitDate) {
                welcomeMessage += '\nYour last visit was on: ' + lastVisitDate;
            }

            alert(welcomeMessage);

            // Update the last visit date
            if (storeVisitorCookie('lastVisitDate', currentDate, 365)) {
                console.log("Last visit date updated.");
            }
        } else {
            // New visitor
            const newVisitorName = prompt('Please enter your name:', "");

            if (newVisitorName != null && newVisitorName != "") {
                if (storeVisitorCookie('visitorName', newVisitorName, 365)) {
                    console.log("Visitor name stored.");
                }
                if (storeVisitorCookie('lastVisitDate', currentDate, 365)) {
                    console.log("First visit date stored.");
                }
                alert('Welcome, ' + newVisitorName + '! This is your first visit.');
            }
        }
    }

    // Function to show visitor information on the page
    function updateVisitorInfo() {
        document.getElementById('visitorNameDisplay').textContent = retrieveVisitorCookie('visitorName') || 'No name set';
        document.getElementById('lastVisitDisplay').textContent = retrieveVisitorCookie('lastVisitDate') || 'No previous visits';
    }

    // Function to clear all cookies related to the visit
    function clearVisitorCookies() {
        document.cookie = "visitorName=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        document.cookie = "lastVisitDate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        updateVisitorInfo();
        location.reload();
    }

    // Initialize functions on page load
    window.onload = function() {
        console.log("Page has loaded, running visitor cookie management.");
        manageVisitorCookies();
        updateVisitorInfo();
        setInterval(updateVisitorInfo, 2000); // Refresh info every 2 seconds
    };
    </script>
</head>
<body>
    <header>
        <h1>Visitor Tracking Portal</h1>
        <p>Experience personalized tracking with cookies</p>
    </header>
    <main>
        <section>
            <h2>Visitor Details</h2>
            <p><strong>Visitor Name:</strong> <span id="visitorNameDisplay">Not Set</span></p>
            <p><strong>Last Visit:</strong> <span id="lastVisitDisplay">Not Available</span></p>
            <button onclick="clearVisitorCookies()">Clear Your Cookies</button>
        </section>

        <section>
            <h2>Visitor Actions</h2>
            <p>Click the button to manage your cookies. If you're a returning visitor, you'll see the date of your last visit.</p>
            <button onclick="manageVisitorCookies()">Manage Cookies</button>
        </section>

        <section>
            <h2>About This Page</h2>
            <p>This simple visitor tracking tool uses cookies to store your name and the date of your last visit. Each time you return, your previous information will be displayed.</p>
        </section>
    </main>
</body>
</html>
